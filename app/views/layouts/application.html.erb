<!DOCTYPE html>
<html>
<head>
  <title>GoodLife</title>
  <%= stylesheet_link_tag :all %>
  <%= javascript_include_tag :defaults %>
  <meta charset="utf-8">
  <%= csrf_meta_tag %>
</head>
<body>
<div id="wrapper">
<div class="row" id="header">
  <head>
  <%= navigation :main %>

  <div class="column grid_14">
    <% if user_signed_in? %>
        <%= current_user.name %> is logged in. Not you? Click <%= link_to "Sign Out", destroy_user_session_path, :method => 'delete' %>
    <% else %>
        <%= link_to "Register", new_user_registration_path %> or <%= link_to "Sign In", new_user_session_path %>
    <% end %>
    <div class="search_form" style="float: right">
      <%= form_tag search_path, :method=>'get' do%>
		<p>
			<%= text_field_tag :search, params[:search] %>
			<%= submit_tag 'Search' %>
		</p>
	  <% end %>
    </div>
    <p class="notice">
      <%= notice %>
      <% if user_signed_in? %>
        <%= link_to "Invite friends now!", new_user_invitation_path %>
      <% end %>
    </p>
    <p class="alert"><%= alert %></p>
  </div>
  </head>
</div>
<div class="row" id="content">
  <div class="column grid_11">
    <%= yield %>
  </div>
  <div class="column grid_3">
    <aside>
  <% unless user_signed_in? %>
    <div class="row">
      <div class="column grid_3">
        <h3>most populate feats</h3>
        <div>
        <% Feat.sort_by_popular.limit(3).each do |f| %>
          <p>
          <span><%="!#{f.name}" %></span>
          <span><%="#{f.bonus_points} points" %></span>
          </p>
        <% end %>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="column grid_3">
        <h3>most populate rewards</h3>
        <div>
        <% Reward.limit(3).each do |r| %>
          <p>
          <span><%="$#{r.save_money} #{r.name}" %></span>
          </p>
        <% end %>
        </div>
      </div>
    </div>
  <% else %>
    <div class="row">
       <div class="column grid_3">
         <h3>my team ranking</h3>
         <% current_user.members.each do |m| %>
          <p>
          <span><%= "#{m.name} #{m.earned_points}" %></span>
          </p>
         <% end %>
       </div>
    </div>
    <div class="row">
       <div class="column grid_3">
         <h3>my challenges</h3>
         <% current_user.challenges.each do |c| %>
          <p>
          <% if current_user.challenge_completed?(c) %>
            <span><%= "#{c.name} 完成" %></span>
          <% else %>
            <span><%= "#{c.name} #{c.completed_feats(current_user).size}/#{c.feats.size}" %></span>
          <% end %>
          </p>
         <% end %>
       </div>
    </div>
  <% end %>
  </aside>
  </div>
</div>
<div id="clear"></div>
</div>
<div class="row" id="footer">
  <% unless Content.all.nil? %>
    <%= navigation :footer %>
  <% end %>
</div>
</body>
</html>
